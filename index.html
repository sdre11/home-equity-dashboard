<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Home Equity & Treasury Dashboard</title>
<style>
body {
font-family: Arial, sans-serif;
max-width: 700px;
margin: 20px auto;
padding: 0 15px;
color: #222;
background: #f9f9f9;
}
h1, h2 {
text-align: center;
}
.section {
background: white;
padding: 20px 25px;
border-radius: 10px;
margin-bottom: 30px;
box-shadow: 0 0 8px rgba(0,0,0,0.1);
}
/* Range bar styles */
.range-bar {
position: relative;
height: 20px;
background: linear-gradient(to right, #4CAF50 0%, #FFEB3B 50%, #F44336 100%);
border-radius: 10px;
margin: 20px 0 40px 0;
}
.marker {
position: absolute;
top: -10px;
width: 2px;
height: 40px;
background: #333;
}
.label {
font-size: 0.8em;
color: #333;
text-align: center;
position: absolute;
top: 30px;
width: 40px;
margin-left: -20px;
}
.pointer {
position: absolute;
top: -15px;
width: 0;
height: 0;
border-left: 10px solid transparent;
border-right: 10px solid transparent;
border-bottom: 15px solid #000;
transition: left 0.5s ease;
}
#currentYield {
font-weight: bold;
font-size: 1.2em;
text-align: center;
}
/* Rate display */
.rate-display {
font-size: 1.3em;
font-weight: bold;
text-align: center;
margin-top: 10px;
}
/* Color coding for rates */
.rate-good {
color: green;
}
.rate-average {
color: black;
}
.rate-bad {
color: red;
}
/* Chart toggle buttons */
.toggle-buttons {
text-align: center;
margin-bottom: 15px;
}
.toggle-buttons button {
margin: 0 5px;
padding: 10px 20px;
border: none;
background-color: #4CAF50;
color: white;
border-radius: 5px;
cursor: pointer;
font-weight: bold;
transition: background-color 0.3s ease;
}
.toggle-buttons button.active {
background-color: #388E3C;
}
/* Placeholder chart area */
#chartArea {
width: 100%;
max-width: 650px;
height: 300px;
background: #eee;
border-radius: 10px;
text-align: center;
line-height: 300px;
color: #666;
font-style: italic;
user-select: none;
margin: 0 auto 40px auto;
}
/* Responsive adjustments */
@media (max-width: 600px) {
#chartArea {
height: 200px;
line-height: 200px;
}
}
</style>
</head>
<body>

<h1>Home Equity & Treasury Dashboard</h1>

<!-- Treasury Yield Section -->
<div class="section" id="treasurySection">
<h2>10-Year Treasury Yield</h2>
<div class="range-bar" id="rangeBar">
<div class="marker" style="left: 30%;"></div>
<div class="label" style="left: 30%;">3.0%</div>

<div class="marker" style="left: 80%;"></div>
<div class="label" style="left: 80%;">4.0%</div>

<div id="ratePointer" class="pointer" style="left: 0;"></div>
</div>
<p id="currentYield">Loading...</p>
</div>

<!-- HELOC Rate Section -->
<div class="section" id="helocSection">
<h2>HELOC Average Rate (FRED)</h2>
<p id="helocRate" class="rate-display">Loading...</p>
</div>

<!-- Home Equity Loan Rate Section -->
<div class="section" id="helSection">
<h2>Estimated Home Equity Loan Rate</h2>
<p id="helRate" class="rate-display">Loading...</p>
</div>

<!-- Chart Section -->
<div class="section" id="chartSection">
<h2>Rate Trends</h2>
<div class="toggle-buttons">
<button id="btn30" class="active">Last 30 Days</button>
<button id="btn12">Last 12 Months</button>
</div>
<div id="chartArea">Chart will appear here</div>
</div>

<script>
// === Utilities for coloring rates based on thresholds ===
function getRateStatus(rate, goodThreshold, badThreshold) {
if (rate <= goodThreshold) return { status: "Good", className: "rate-good" };
else if (rate <= badThreshold) return { status: "Average", className: "rate-average" };
else return { status: "Bad", className: "rate-bad" };
}

// --- 10-Year Treasury Yield ---
const goodLimit = 3.0;
const badLimit = 4.0;
const minRate = 2.0;
const maxRate = 5.0;

function rateToPercent(rate) {
let pct = ((rate - minRate) / (maxRate - minRate)) * 100;
if (pct < 0) pct = 0;
if (pct > 100) pct = 100;
return pct;
}

// Fetch 10-year treasury yield and update UI
fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://api.fiscaldata.treasury.gov/services/api/fiscal_service/v2/accounting/od/avg_interest_rates?sort=-record_date&page[size]=5'))
.then(res => res.json())
.then(data => {
const jsonData = JSON.parse(data.contents);
if (jsonData.data && jsonData.data.length > 0) {
const tenYear = jsonData.data.find(item => item.security_desc === "Treasury Notes");
if (tenYear) {
const yieldValue = parseFloat(tenYear.avg_interest_rate_amt);
const pointer = document.getElementById("ratePointer");
const currentYield = document.getElementById("currentYield");

const percent = rateToPercent(yieldValue);
pointer.style.left = percent + "%";
currentYield.textContent = yieldValue.toFixed(3) + "%";

} else {
document.getElementById("currentYield").textContent = "N/A";
}
} else {
document.getElementById("currentYield").textContent = "N/A";
}
})
.catch(() => {
document.getElementById("currentYield").textContent = "Error loading";
});

// --- HELOC & Home Equity Loan from FRED ---
const fredApiKey = '81e345b599b3999f883813cf72dc8de5'; // Your FRED API key here
const homeEquityLoanSpread = 0.75; // % points added to HELOC rate for home equity loan estimate

async function fetchFredHelocRate() {
const url = `https://api.stlouisfed.org/fred/series/observations?series_id=DRHEIMK&api_key=${fredApiKey}&file_type=json&sort_order=desc&limit=1`;
try {
const res = await fetch(url);
const json = await res.json();
if (json.observations && json.observations.length > 0) {
return parseFloat(json.observations[0].value);
}
} catch (e) {
console.error('Error fetching FRED HELOC rate', e);
}
return null;
}

// Simulate fallback rate if API fails
function simulateFetchRate(min, max) {
return (Math.random() * (max - min) + min).toFixed(3);
}

// Update UI for rates with coloring
function updateRateDisplay(id, rate, good, bad, prefix="") {
const el = document.getElementById(id);
const { status, className } = getRateStatus(rate, good, bad);
el.textContent = prefix + rate.toFixed(3) + "% â€” " + status;
el.className = "rate-display " + className;
}

async function fetchAndUpdateRates() {
const helocRate = await fetchFredHelocRate() || parseFloat(simulateFetchRate(6.0, 10.0));
const helRate = helocRate + homeEquityLoanSpread;

updateRateDisplay("helocRate", helocRate, 7.5, 9.0);
updateRateDisplay("helRate", helRate, 7.0, 9.5, "Estimated: ");
}

fetchAndUpdateRates();
setInterval(fetchAndUpdateRates, 5 * 60 * 1000); // every 5 minutes

// --- Chart toggle buttons logic ---
const btn30 = document.getElementById("btn30");
const btn12 = document.getElementById("btn12");
const chartArea = document.getElementById("chartArea");

function setActiveButton(activeBtn) {
btn30.classList.remove("active");
btn12.classList.remove("active");
activeBtn.classList.add("active");
}

btn30.addEventListener("click", () => {
setActiveButton(btn30);
chartArea.textContent = "Showing chart for last 30 days (placeholder)";
// TODO: Add chart rendering logic here
});

btn12.addEventListener("click", () => {
setActiveButton(btn12);
chartArea.textContent = "Showing chart for last 12 months (placeholder)";
// TODO: Add chart rendering logic here
});

// Initialize with 30-day chart
chartArea.textContent = "Showing chart for last 30 days (placeholder)";
</script>

</body>
</html>
